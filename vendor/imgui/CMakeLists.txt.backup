set(IMGUI_DIR ${CMAKE_CURRENT_SOURCE_DIR})

set(CMAKE_DEBUG_POSTFIX d)
set(CMAKE_CXX_STANDARD 20)
set(CMAKE_CXX_STANDARD_REQUIRED)

set(ROOT ${IMGUI_DIR})

add_library(imgui STATIC
    ${ROOT}/imgui.cpp
    ${ROOT}/imgui.h
    ${ROOT}/imstb_rectpack.h
    ${ROOT}/imstb_textedit.h
    ${ROOT}/imstb_truetype.h
    ${ROOT}/imgui_demo.cpp
    ${ROOT}/imgui_draw.cpp
    ${ROOT}/imgui_internal.h
    ${ROOT}/imgui_tables.cpp
    ${ROOT}/imgui_widgets.cpp
    )
add_library(imgui::imgui ALIAS imgui)
target_include_directories(imgui
    PUBLIC
        $<BUILD_INTERFACE:${ROOT}>
        $<INSTALL_INTERFACE:include>
    PRIVATE
        $<BUILD_INTERFACE:${ROOT}/../include/glfw>
    )

set(INSTALL_TARGETS imgui)
set(INSTALL_HEADERS ${ROOT}/imgui.h ${ROOT}/imconfig.h)

foreach(BACKEND glfw opengl3)
    set(NAME imgui_impl_${BACKEND})
    set(HEADER ${ROOT}/backends/${NAME}.h)
    add_library(${NAME} STATIC ${ROOT}/backends/${NAME}.cpp ${HEADER})
    add_library(imgui::${NAME} ALIAS ${NAME})
    target_link_libraries(${NAME} PUBLIC imgui)
    target_include_directories(${NAME} PUBLIC
        $<BUILD_INTERFACE:${ROOT}/backends>
        $<INSTALL_INTERFACE:include>
        )
    LIST(APPEND INSTALL_TARGETS ${NAME})
    LIST(APPEND INSTALL_HEADERS ${HEADER})
endforeach()

target_include_directories(imgui_impl_glfw PRIVATE
    $<BUILD_INTERFACE:${ROOT}/../glfw/include>
    )
#target_link_libraries(imgui_impl_glfw PRIVATE toodee::glfw3)
target_sources(imgui_impl_opengl3 PRIVATE ${ROOT}/backends/imgui_impl_opengl3_loader.h)
#target_link_libraries(imgui_impl_opengl3 PRIVATE OpenGL::GL)

#install(TARGETS ${INSTALL_TARGETS}
#    EXPORT imgui-targets DESTINATION lib)
#install(EXPORT imgui-targets
#    FILE imgui-config.cmake
#    NAMESPACE imgui::
#    DESTINATION lib/cmake/imgui)
#install(FILES ${INSTALL_HEADERS}
#    DESTINATION include)
